<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Gá»­i PÃ­ Na cá»§a anh ğŸ’•</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --pink:#ff3f86;
  --red:#ff2a2a;
  --gold:#ffcc4d;
  --bg1:#fff1f7;
  --bg2:#ffe6f1;
  --card:#ffffff;
  --shadow:0 28px 80px rgba(0,0,0,.16);

  --pad: clamp(14px, 4vw, 22px);
  --radius: 22px;
  --btnH: 52px;

  --text: clamp(15px, 3.8vw, 18px);
  --title: clamp(24px, 6vw, 34px);
  --sub: clamp(17px, 4.5vw, 22px);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:"Baloo 2",sans-serif;
  font-size: var(--text);
  color:#2a2230;
  background:
    radial-gradient(900px 420px at 15% 0%, #ffffff 0%, rgba(255,255,255,.0) 60%),
    radial-gradient(900px 420px at 85% 0%, #ffffff 0%, rgba(255,255,255,.0) 60%),
    radial-gradient(circle at top, var(--bg1), var(--bg2));
  overflow-x:hidden;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

/* subtle Táº¿t vibe */
.bg-dots{
  position:fixed; inset:0;
  pointer-events:none;
  background:
    radial-gradient(circle at 20% 12%, rgba(255,204,77,.22), transparent 28%),
    radial-gradient(circle at 80% 18%, rgba(255,63,134,.18), transparent 30%),
    radial-gradient(circle at 50% 0%, rgba(255,42,42,.10), transparent 38%);
  filter: blur(0.2px);
  opacity:.85;
}

.app{
  min-height:100dvh;
  padding: var(--pad);
  display:flex;
  align-items:flex-start;
  justify-content:center;
}

/* FLOATING */
.floating{
  position:fixed;
  bottom:-20px;
  font-size:18px;
  opacity:.9;
  animation:floatUp linear infinite;
  pointer-events:none;
  filter: drop-shadow(0 10px 12px rgba(0,0,0,.10));
}
@keyframes floatUp{
  to{transform:translateY(-110vh);opacity:0}
}

/* HEART CONFETTI "BÃ™M CHÃU" */
.boom{
  position:fixed;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  pointer-events:none;
  z-index:9999;
}
.boom .p{
  position:absolute;
  left:0; top:0;
  transform:translate(-50%,-50%);
  font-size: 18px;
  opacity:0;
  animation:pop 900ms ease forwards;
}
@keyframes pop{
  0%{opacity:0; transform:translate(-50%,-50%) scale(.6)}
  10%{opacity:1}
  100%{opacity:0; transform:translate(calc(-50% + var(--x)), calc(-50% + var(--y))) scale(1.3)}
}

/* ===== PAGE 1 ===== */
.intro{text-align:center; width:min(520px, 100%)}
.intro h2{
  margin: 14px 0 6px;
  font-size: clamp(20px, 5.5vw, 28px);
  line-height:1.25;
}
.intro p{ margin:6px 0; opacity:.92 }

.gift{
  width:min(320px, 86vw);
  aspect-ratio:1/1;
  position:relative;
  cursor:pointer;
  margin: 10px auto 6px;
  user-select:none;
}
.gift-box{
  position:absolute;
  bottom:0;
  width:100%;
  height:70%;
  background:#ffd1e6;
  border-radius:26px;
  box-shadow: 0 22px 40px rgba(0,0,0,.12);
}
.ribbon-v{
  position:absolute;
  width:18%;
  height:100%;
  background:linear-gradient(180deg, var(--red), var(--pink));
  left:50%;
  transform:translateX(-50%);
  border-radius: 18px;
}
.ribbon-h{
  position:absolute;
  height:14%;
  width:100%;
  background:linear-gradient(90deg, var(--red), var(--pink));
  top:43%;
  border-radius: 18px;
}
.gift-lid{
  position:absolute;
  top:0;
  width:100%;
  height:28%;
  background:#ffddee;
  border-radius:26px;
  transform-origin:15% 100%;
  box-shadow: 0 16px 26px rgba(0,0,0,.10);
}
.gift.opening .gift-lid{ animation:openLid .7s forwards; }
@keyframes openLid{
  to{transform:rotate(-35deg) translate(-20px,-10px)}
}
.tap-hint{
  display:inline-flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  margin-top: 10px;
  padding: 10px 14px;
  border-radius: 999px;
  background: rgba(255,255,255,.72);
  box-shadow: 0 10px 20px rgba(0,0,0,.08);
  font-weight: 800;
}

/* ===== PAGE 2 ===== */
.content{
  display:none;
  width:100%;
  max-width:920px;
  background: var(--card);
  border-radius: var(--radius);
  padding: clamp(16px, 4vw, 28px);
  box-shadow: var(--shadow);
  position:relative;
  overflow:hidden;
}

/* pseudo-element khÃ´ng cháº·n click */
.content::before,
.content::after{
  pointer-events:none;
  z-index:0;
}

.content:before{
  content:"";
  position:absolute;
  left:-60px; top:-60px;
  width:220px; height:220px;
  background: radial-gradient(circle at 40% 40%, rgba(255,204,77,.45), rgba(255,63,134,.10) 58%, transparent 70%);
  transform: rotate(18deg);
}
.content:after{
  content:"";
  position:absolute;
  right:-70px; top:-70px;
  width:240px; height:240px;
  background: radial-gradient(circle at 35% 35%, rgba(255,42,42,.30), rgba(255,63,134,.08) 60%, transparent 72%);
  transform: rotate(-18deg);
}

.content-inner{
  display:flex;
  gap: clamp(14px, 3vw, 28px);
  align-items:flex-start;
  position:relative;
  z-index:1;
}
.text-col{flex:1}

.image-col{
  width: 260px;
  opacity:0;
  transform:scale(.88);
  position:relative;
  z-index:1;
}
.image-col.show{ animation:imageFade 900ms ease forwards; }
@keyframes imageFade{ to{opacity:1;transform:scale(1)} }
.image-col img{
  width:100%;
  border-radius:18px;
  box-shadow:0 18px 36px rgba(0,0,0,.2);
}

/* reveal */
.reveal{ opacity:0; transform:translateY(14px); position:relative; z-index:1; }
.reveal.show{ animation:fadeUp .55s ease forwards; }
@keyframes fadeUp{ to{opacity:1;transform:translateY(0)} }

.big-title{
  text-align:center;
  color:var(--pink);
  font-size: var(--title);
  font-weight:800;
  margin-bottom: 10px;
}
.text-col p{
  text-align:center;
  line-height:1.75;
  margin: 8px 0;
}
.big-question{
  margin: 16px 0 10px;
  text-align:center;
  font-size: var(--sub);
  font-weight:900;
  color:#ff2f7a;
}

/* boxes */
.box-row{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin: 18px 0 0;
  justify-content:center;
  z-index:2;
}
.box{
  padding: 14px;
  background: linear-gradient(180deg, #fff3f8, #ffe9f3);
  border-radius: 18px;
  text-align:left;
  font-weight:900;
  cursor:pointer;
  border: 1px solid rgba(255,63,134,.18);
  box-shadow: 0 14px 26px rgba(0,0,0,.08);
  transition: transform .12s ease;
  min-height: 110px;
}
.box:active{ transform: scale(.98) }
.box .label{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  font-size: 18px;
}
.box small{
  display:block;
  font-weight:800;
  opacity:.82;
  margin-top:6px;
  line-height:1.35;
}
.box-result{
  margin-top: 12px;
  font-weight:900;
  color: var(--pink);
  line-height:1.45;
}

/* buttons / inputs */
.btn{
  height: var(--btnH);
  width:100%;
  border:none;
  border-radius: 16px;
  font-family:inherit;
  font-weight:900;
  cursor:pointer;
  background: linear-gradient(90deg, var(--red), var(--pink));
  color:white;
  box-shadow: 0 16px 30px rgba(255,63,134,.25);
}
.btn:active{ transform: scale(.99) }

.btn-ghost{
  height: 44px;
  width:100%;
  border-radius: 14px;
  border:1px solid rgba(255,63,134,.22);
  background: rgba(255,255,255,.8);
  font-family:inherit;
  font-weight:900;
  cursor:pointer;
}

textarea{
  width:100%;
  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.92);
  padding: 12px 12px;
  font-family:inherit;
  font-size: var(--text);
  line-height:1.5;
  outline:none;
  resize:none;
  min-height: 110px;
  color:#2a2230;
}

.helper{
  margin-top:10px;
  font-weight:800;
  opacity:.85;
  text-align:center;
}

/* footer */
.love-footer{
  margin-top: 18px;
  padding-top: 14px;
  border-top:1px dashed #ffd1e6;
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  gap: 10px;
  z-index:1;
}
.love-left p{margin:6px 0;font-weight:800}
.love-right{font-weight:900;color:var(--pink)}

/* ===== MOBILE ===== */
@media (max-width: 820px){
  .content-inner{
    flex-direction:column;
    align-items:center;
  }
  .image-col{
    width: min(340px, 86vw);
    margin-top: 8px;
  }
}
@media (max-width: 520px){
  .box-row{ grid-template-columns: 1fr; }
}

/* panel */
.panel{
  margin-top: 12px;
  padding: 14px;
  border-radius: 18px;
  background: rgba(255,240,248,.7);
  border: 1px solid rgba(255,63,134,.18);
  z-index:3;
  position:relative;
}
.panel h3{
  margin:0 0 8px;
  font-size: 18px;
  color:#ff2f7a;
}
.panel .big{
  font-size: 28px;
  font-weight: 900;
  color: #ff2f7a;
  text-align:center;
  margin: 10px 0 6px;
}
.panel .meaning{
  text-align:center;
  font-weight:900;
  line-height:1.4;
}
</style>
</head>

<body>
<div class="bg-dots"></div>
<div class="app">

<section class="intro" id="intro">
  <div class="gift" id="gift" aria-label="Má»Ÿ quÃ ">
    <div class="gift-lid"></div>
    <div class="gift-box">
      <div class="ribbon-v"></div>
      <div class="ribbon-h"></div>
    </div>
  </div>

  <h2>PÃ­ Na dá»… thÆ°Æ¡ng<br>Anh thÆ°Æ¡ng PÃ­ Na láº¯m Ã¡aaa</h2>
  <p>Anh cÃ³ mÃ³n quÃ  Táº¿t nhá» nhá», nhÆ°ng Ä‘áº§y yÃªu thÆ°Æ¡ng ğŸ’—</p>
  <div class="tap-hint">ğŸ <span>Cháº¡m Ä‘á»ƒ má»Ÿ quÃ  nÃ¨eee</span> âœ¨</div>
</section>

<section class="content" id="content">
  <div class="big-title reveal">Gá»­i PÃ­ Na cá»§a anh ğŸ’•</div>

  <div class="content-inner">
    <div class="text-col">
      <p class="reveal">NhÃ¢n dá»‹p <b>Táº¿t 2026</b> ğŸŠ</p>
      <p class="reveal">Anh chÃºc PÃ­ Na luÃ´n xinh xáº¯n, Ä‘Ã¡ng yÃªu ğŸŒ¸</p>
      <p class="reveal">luÃ´n khá»e máº¡nh, vui váº» vÃ  bÃ¬nh an ğŸ§§</p>
      <p class="reveal">Ä‘iá»u gÃ¬ cÅ©ng hanh thÃ´ng, Æ°á»›c gÃ¬ cÅ©ng thÃ nh âœ¨</p>
      <p class="reveal">vÃ â€¦ nÄƒm nay mÃ¬nh thÆ°Æ¡ng nhau nhiá»u hÆ¡n nÄƒm trÆ°á»›c ná»¯a nha ğŸ’–</p>

      <div class="big-question reveal">
        PÃ­ Na muá»‘n má»Ÿ mÃ³n nÃ o trÆ°á»›c nÃ¨eee? ğŸ’—
      </div>
    </div>

    <div class="image-col" id="imageCol">
      <img src="Cafeee.jpeg" alt="PÃ­ Na">
    </div>
  </div>

  <div class="box-row reveal" id="boxRow">
    <div class="box" id="boxLucky">
      <div class="label"><span>ğŸ§§ LÃ¬ xÃ¬ may máº¯n</span><span>â€º</span></div>
      <small>Láº¯c Ä‘iá»‡n thoáº¡i Ä‘á»ƒ Ä‘á»•i sá»‘ tuá»³ thÃ­ch ğŸ’¥ğŸ’—</small>
      <div class="box-result" id="luckyPreview"></div>
    </div>

    <div class="box" id="boxWish">
      <div class="label"><span>ğŸŒ  Äiá»u Æ°á»›c cá»§a PÃ­ Na</span><span>â€º</span></div>
      <small>GÃµ thoáº£i mÃ¡i, khÃ´ng giá»›i háº¡n kÃ½ tá»± nha âœï¸</small>
      <div class="box-result" id="wishPreview"></div>
    </div>
  </div>

  <!-- GIá»® reveal Ä‘á»ƒ fade, nhÆ°ng JS sáº½ â€œÃ©p hiá»‡nâ€ khi user báº¥m box -->
  <div class="panel reveal" id="panel" style="display:none;"></div>

  <div class="love-footer reveal" id="footer">
    <div class="love-left">
      <p>Anh thÆ°Æ¡ng PÃ­ Na nháº¥t trÃªn Ä‘á»i ğŸ’—ğŸ’—ğŸ’—</p>
      <p>ChÃºc má»«ng nÄƒm má»›i nÃ¨eee ğŸŠ</p>
      <p>Tá»¥i mÃ¬nh cÃ¹ng cá»‘ gáº¯ng vá» 1 nhÃ  nhaaaaa ğŸ’</p>
    </div>
    <div class="love-right">Anh yÃªu cá»§a PÃ­ Naaa</div>
  </div>
</section>

</div>

<audio id="music" loop>
  <source src="mot-ngay-hay-tram-nam.mp3">
</audio>

<script>
const gift = document.getElementById("gift");
const intro = document.getElementById("intro");
const content = document.getElementById("content");
const music = document.getElementById("music");
const imageCol = document.getElementById("imageCol");

const boxLucky = document.getElementById("boxLucky");
const boxWish  = document.getElementById("boxWish");
const luckyPreview = document.getElementById("luckyPreview");
const wishPreview  = document.getElementById("wishPreview");
const panel = document.getElementById("panel");
const boxRow = document.getElementById("boxRow");
const footer = document.getElementById("footer");

let opened = false;

/* MUSIC */
function playMusic(){
  try{
    music.volume = 0;
    music.play();
    let v = 0;
    const fade = setInterval(()=>{
      v += 0.02;
      if(v >= 0.5){ v = 0.5; clearInterval(fade); }
      music.volume = v;
    }, 120);
  }catch(e){}
}

/* HEART BOOM */
function boomHearts(x=window.innerWidth/2, y=window.innerHeight/2, count=18){
  const wrap = document.createElement("div");
  wrap.className = "boom";
  wrap.style.left = x + "px";
  wrap.style.top  = y + "px";

  const chars = ["ğŸ’–","ğŸ’—","ğŸ’","âœ¨","ğŸ’˜"];
  for(let i=0;i<count;i++){
    const p = document.createElement("div");
    p.className = "p";
    p.textContent = chars[Math.floor(Math.random()*chars.length)];
    const angle = Math.random()*Math.PI*2;
    const dist = 70 + Math.random()*140;
    p.style.setProperty("--x", (Math.cos(angle)*dist)+"px");
    p.style.setProperty("--y", (Math.sin(angle)*dist)+"px");
    p.style.animationDelay = (Math.random()*120)+"ms";
    wrap.appendChild(p);
  }
  document.body.appendChild(wrap);
  setTimeout(()=>wrap.remove(), 1000);
}
function vibrate(ms=30){ if(navigator.vibrate) navigator.vibrate(ms); }

/* âœ… FIX CHÃNH: Ã©p panel hiá»‡n ngay khi user báº¥m box
   VÃ¬ panel cÃ³ class "reveal" -> opacity 0 náº¿u khÃ´ng add "show" */
function openPanel(){
  panel.style.display = "block";
  panel.classList.add("show");
  panel.style.opacity = "1";
  panel.style.transform = "translateY(0)";
}

/* TYPEWRITER */
function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
async function typeLine(el, totalMs = 3600){
  const full = el.dataset.fulltext ?? el.textContent;
  el.dataset.fulltext = full;
  el.textContent = "";
  el.classList.add("show");

  const n = Math.max(1, full.length);
  const step = Math.max(15, Math.floor(totalMs / n));
  for(let i=1;i<=n;i++){
    el.textContent = full.slice(0,i);
    await sleep(step);
  }
}

async function playTypewriterSequence(){
  const title = document.querySelector(".big-title.reveal");
  const lines = Array.from(document.querySelectorAll(".text-col p.reveal"));
  const question = document.querySelector(".big-question.reveal");

  setTimeout(()=>imageCol.classList.add("show"), 900);

  if(title) await typeLine(title, 3600);
  for(const el of lines){
    await typeLine(el, 3600);
    await sleep(200);
  }
  if(question) await typeLine(question, 3600);

  boxRow.classList.add("show");
  await sleep(250);
  footer.classList.add("show");
}

/* OPEN GIFT */
gift.onclick = (e) => {
  if(opened) return;
  opened = true;

  playMusic();
  gift.classList.add("opening");
  vibrate(25);
  boomHearts(e.clientX || window.innerWidth/2, e.clientY || window.innerHeight/2, 22);

  setTimeout(()=>{
    intro.style.display="none";
    content.style.display="block";
    playTypewriterSequence();
  }, 850);
};

/* LUCKY LIST (+0805) */
const LUCKY_LIST = [
  { value:"0805", meaning:"NgÃ y mÃ¬nh báº¯t Ä‘áº§u quen nhau â€” vÃ  anh muá»‘n bÃªn PÃ­ Na mÃ£i mÃ£i, khÃ´ng chá»‰ má»™t mÃ¹a Táº¿t ğŸ’–" },
  { value:"68",   meaning:"Lá»™c PhÃ¡t â€” NÄƒm nay tÃ i lá»™c gÃµ cá»­a, cÃ²n anh thÃ¬ á»Ÿ láº¡i bÃªn PÃ­ Na ğŸ’—" },
  { value:"86",   meaning:"PhÃ¡t Lá»™c â€” LÃ m gÃ¬ cÅ©ng thuáº­n, yÃªu gÃ¬ cÅ©ng bá»n nha ğŸŒ¸" },
  { value:"99",   meaning:"TrÆ°á»ng Cá»­u â€” KhÃ´ng chá»‰ nÄƒm nay, mÃ  lÃ  dÃ i lÃ¢u ğŸ’" },
  { value:"1314", meaning:"Má»™t Ä‘á»i má»™t kiáº¿p â€” Anh chá»n yÃªu PÃ­ Na khÃ´ng cÃ³ thá»i háº¡n ğŸ’˜" },
  { value:"2026", meaning:"NÄƒm cá»§a tá»¥i mÃ¬nh â€” MÃ¬nh thÆ°Æ¡ng nhau rá»±c rá»¡ trong nÄƒm má»›i âœ¨" }
];

const LS_LUCKY = "pina_lucky";
let lucky = localStorage.getItem(LS_LUCKY) || "";

function pickLucky(){
  const item = LUCKY_LIST[Math.floor(Math.random()*LUCKY_LIST.length)];
  lucky = item.value;
  localStorage.setItem(LS_LUCKY, lucky);
  return item;
}
function renderLuckyPreview(){
  if(lucky){
    const item = LUCKY_LIST.find(x=>x.value===lucky) || {value:lucky};
    luckyPreview.textContent = `Sá»‘ hiá»‡n táº¡i: ${item.value} ğŸ’—`;
  }else luckyPreview.textContent = "";
}
renderLuckyPreview();

function showLuckyPanel(forceNew=false){
  const item = (forceNew || !lucky) ? pickLucky() : (LUCKY_LIST.find(x=>x.value===lucky) || pickLucky());
  renderLuckyPreview();

  openPanel();
  panel.innerHTML = `
    <h3>ğŸ§§ LÃ¬ xÃ¬ may máº¯n cá»§a PÃ­ Na</h3>
    <div class="big">${item.value}</div>
    <div class="meaning">${item.meaning}</div>
    <div style="height:12px"></div>
    <button class="btn" id="btnReceive">Nháº­n lÃ¬ xÃ¬ cá»§a anh ğŸ’¥</button>
    <div style="height:10px"></div>
    <button class="btn-ghost" id="btnShakeOn">Báº­t cháº¿ Ä‘á»™ láº¯c ğŸ›ï¸</button>
    <div class="helper">Láº¯c nháº¹ Ä‘á»ƒ Ä‘á»•i sá»‘ tuá»³ thÃ­ch nha ğŸ’—</div>
  `;

  const btnReceive = document.getElementById("btnReceive");
  btnReceive.onclick = () => {
    const extra = (item.value === "0805") ? 44 : 28;
    vibrate(45);
    boomHearts(window.innerWidth/2, window.innerHeight/2, extra);
    btnReceive.textContent = "Anh ghi ná»£ lÃ¬ xÃ¬ tháº­t â€” trao táº­n tay PÃ­ Na nha ğŸ’—";
    btnReceive.disabled = true;
    btnReceive.style.opacity = .95;
  };

  document.getElementById("btnShakeOn").onclick = async () => {
    const ok = await enableShake();
    vibrate(20);
    document.getElementById("btnShakeOn").textContent = ok ? "ÄÃ£ báº­t láº¯c âœ…" : "KhÃ´ng báº­t Ä‘Æ°á»£c ğŸ¥º";
  };
}

boxLucky.onclick = (e) => {
  showLuckyPanel(false);
  vibrate(18);
  boomHearts(e.clientX || window.innerWidth/2, e.clientY || window.innerHeight/2, 16);
};

/* WISH */
const LS_WISH = "pina_wish";

function escapeHTML(str){
  return str.replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[m]));
}
function renderWishPreview(){
  const saved = (localStorage.getItem(LS_WISH) || "").trim();
  wishPreview.textContent = saved ? "CÃ³ Ä‘iá»u Æ°á»›c Ä‘Ã£ lÆ°u ğŸ’—" : "";
}
renderWishPreview();

function showWishPanel(){
  const saved = localStorage.getItem(LS_WISH) || "";

  openPanel();
  panel.innerHTML = `
    <h3>ğŸŒ  Äiá»u Æ°á»›c cá»§a PÃ­ Na</h3>
    <div class="meaning" style="text-align:center; font-weight:900; margin-bottom:10px; color:#ff2f7a;">
      â€œÄiá»u Æ°á»›c cá»§a PÃ­ Na muá»‘n anh thá»±c hiá»‡n nÄƒm nay lÃ  gÃ¬?â€
    </div>

    <textarea id="wishInput" placeholder="PÃ­ Na cá»© gÃµ thoáº£i mÃ¡i nhaâ€¦ (Telex cÅ©ng ok) ğŸ’—"
      autocomplete="off" autocapitalize="sentences" spellcheck="false"></textarea>

    <div style="height:12px"></div>
    <button class="btn" id="btnSendWish">Gá»­i Ä‘iá»u Æ°á»›c âœ¨</button>
    <div style="height:10px"></div>
    <button class="btn-ghost" id="btnClearWish">XoÃ¡ Ä‘á»ƒ viáº¿t láº¡i</button>
    <div class="helper">Tip: Gá»­i xong anh sáº½ â€œÄ‘Ã³ng dáº¥uâ€ nháº­n nhiá»‡m vá»¥ nha ğŸ’–</div>
  `;

  const input = document.getElementById("wishInput");
  input.value = saved;

  const resize = () => {
    input.style.height = "auto";
    input.style.height = Math.min(input.scrollHeight, 360) + "px";
  };
  input.addEventListener("input", () => {
    localStorage.setItem(LS_WISH, input.value);
    resize();
  });
  resize();

  document.getElementById("btnSendWish").onclick = () => {
    const wish = input.value.trim();
    if(!wish){
      vibrate(20);
      boomHearts(window.innerWidth/2, window.innerHeight/2, 12);
      input.focus();
      return;
    }

    localStorage.setItem(LS_WISH, wish);
    renderWishPreview();

    vibrate(55);
    boomHearts(window.innerWidth/2, window.innerHeight/2, 30);

    openPanel();
    panel.innerHTML = `
      <h3>âœ… Anh Ä‘Ã£ nháº­n nhiá»‡m vá»¥!</h3>
      <div class="meaning" style="text-align:center; font-weight:900; color:#ff2f7a;">
        Äiá»u Æ°á»›c cá»§a PÃ­ Na lÃ :
      </div>
      <div class="panel" style="margin-top:10px;">
        <div style="font-weight:900; line-height:1.55;">${escapeHTML(wish).replace(/\n/g,"<br>")}</div>
      </div>
      <div class="meaning" style="margin-top:12px; text-align:center; font-weight:900;">
        Anh nghiÃªm tÃºc thá»±c hiá»‡n. PÃ­ Na yÃªn tÃ¢m nha ğŸ’—
      </div>
      <div style="height:12px"></div>
      <button class="btn" id="btnBackWish">Viáº¿t thÃªm / sá»­a láº¡i</button>
      <div style="height:10px"></div>
      <button class="btn-ghost" id="btnShakeOn2">Báº­t cháº¿ Ä‘á»™ láº¯c ğŸ›ï¸</button>
      <div class="helper">Láº¯c nháº¹ 1 cÃ¡i Ä‘á»ƒ â€œtháº£ saoâ€ âœ¨</div>
    `;

    document.getElementById("btnBackWish").onclick = showWishPanel;
    document.getElementById("btnShakeOn2").onclick = async () => {
      const ok = await enableShake();
      vibrate(20);
      boomHearts(window.innerWidth/2, window.innerHeight/2, 12);
      document.getElementById("btnShakeOn2").textContent = ok ? "ÄÃ£ báº­t láº¯c âœ…" : "KhÃ´ng báº­t Ä‘Æ°á»£c ğŸ¥º";
    };
  };

  document.getElementById("btnClearWish").onclick = () => {
    localStorage.removeItem(LS_WISH);
    input.value = "";
    resize();
    input.focus();
    vibrate(15);
  };
}

boxWish.onclick = (e) => {
  showWishPanel();
  vibrate(18);
  boomHearts(e.clientX || window.innerWidth/2, e.clientY || window.innerHeight/2, 16);
};

/* SHAKE */
let shakeEnabled = false;
let lastShakeTime = 0;

function handleMotion(e){
  if(!shakeEnabled) return;
  const acc = e.accelerationIncludingGravity;
  if(!acc) return;

  const x = acc.x || 0, y = acc.y || 0, z = acc.z || 0;
  const mag = Math.sqrt(x*x + y*y + z*z);

  if(mag > 18){
    const now = Date.now();
    if(now - lastShakeTime < 900) return;
    lastShakeTime = now;

    const panelText = (panel.innerText || "").toLowerCase();

    if(panel.style.display === "block" && panelText.includes("lÃ¬ xÃ¬")){
      const item = pickLucky();
      renderLuckyPreview();
      vibrate(30);
      boomHearts(window.innerWidth/2, window.innerHeight/2, item.value === "0805" ? 40 : 18);
      showLuckyPanel(false);
      return;
    }

    if(panel.style.display === "block" && panelText.includes("Ä‘iá»u Æ°á»›c")){
      vibrate(20);
      boomHearts(window.innerWidth/2, window.innerHeight/2, 14);
    }
  }
}

async function enableShake(){
  try{
    if(typeof DeviceMotionEvent !== "undefined" && typeof DeviceMotionEvent.requestPermission === "function"){
      const res = await DeviceMotionEvent.requestPermission();
      if(res !== "granted") return false;
    }
    if(!shakeEnabled){
      window.addEventListener("devicemotion", handleMotion, { passive:true });
      shakeEnabled = true;
    }
    return true;
  }catch(e){
    return false;
  }
}

/* FLOATING */
const floatChars = ["ğŸ’–","âœ¨","ğŸ§§","ğŸŒ¸","ğŸ’—","ğŸŠ"];
setInterval(()=>{
  const el=document.createElement("div");
  el.className="floating";
  el.style.left=Math.random()*100+"vw";
  el.style.animationDuration=(6+Math.random()*4)+"s";
  el.style.fontSize=(16+Math.random()*10)+"px";
  el.innerText=floatChars[Math.floor(Math.random()*floatChars.length)];
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),10000);
},420);
</script>
</body>
</html>
